---
- become: true
  become_method: sudo
  debugger: never
  gather_facts: true
  hosts: all
  # Run tasks in parallel (one thread per host)
  # This prevents one slow host from blocking others
  serial: "100%" # Run all hosts in parallel (100% of hosts at once)
  roles:
    - base
    - users
    - security
    - storage
    # Skip clean role for production Raspberry Pi nodes (it's for image building)
    - role: clean
      when: not (is_raspberry_pi | default(false))
