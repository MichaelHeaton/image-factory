network:
  version: 2
  ethernets:
    {{ network_interface }}:
      dhcp4: false
      addresses:
        - {{ static_ip }}
      routes:
        - to: default
          via: {{ network_gateway }}
      nameservers:
        addresses:
{% for dns in network_dns_servers %}
          - {{ dns }}
{% endfor %}
{% if storage_ip is defined or production_ip is defined %}
  vlans:
{% if storage_ip is defined %}
    {{ network_interface }}.30:
      id: 30
      link: {{ network_interface }}
      addresses:
        - {{ storage_ip }}
      routes:
        - to: 172.16.30.0/24
          via: 172.16.30.1
      nameservers:
        addresses:
{% for dns in network_dns_servers %}
          - {{ dns }}
{% endfor %}
{% endif %}
{% if production_ip is defined %}
    {{ network_interface }}.10:
      id: 10
      link: {{ network_interface }}
      addresses:
        - {{ production_ip }}
      routes:
        - to: 172.16.10.0/24
          via: 172.16.10.1
      nameservers:
        addresses:
{% for dns in network_dns_servers %}
          - {{ dns }}
{% endfor %}
{% endif %}
{% endif %}

